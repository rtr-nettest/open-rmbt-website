<app-header></app-header>
<app-top-nav></app-top-nav>
<app-breadcrumbs></app-breadcrumbs>
<app-scroll-top></app-scroll-top>
@if (result$ | async; as result) {
<div class="app-wrapper">
  <h1>{{ "History" | translate }}</h1>
  <div class="app-header">
    <h2 *ngIf="result.measurementDate" aria-live="polite">
      {{ "Measurement result from" | translate }}
      {{ result.measurementDate | date : "medium" : undefined : activeLang }}
    </h2>
    <h2 *ngIf="!result.measurementDate" aria-live="polite">
      {{ "Measurement result" | translate }}
    </h2>
    <a
      [routerLink]="'/' + activeLang + '/' + routes.TEST"
      class="app-button"
      mat-flat-button
    >
      {{ "Run test again" | translate }}
    </a>
  </div>
  <div *ngIf="basicResults() as basicResults" class="app-container">
    <app-table
      [columns]="columns"
      [data]="basicResults"
      [sort]="sort"
      [shouldHideHeader]="true"
      [tableClassNames]="['app-table--bordered']"
      aria-live="polite"
    ></app-table>
  </div>
  <ng-container *ngIf="detailedResults() as detailedResult">
    @defer () {
    <div class="app-container" [id]="mapContainerId" style="margin-top: 24px">
      <h4>{{ "Position" | translate }}</h4>
      <app-map
        [params]="mapParams()"
        [mapContainerId]="mapContainerId"
      ></app-map>
      <app-location-details
        [details]="locationTable()"
        style="display: block; margin-top: 24px"
      ></app-location-details>
    </div>
    <h3 class="app-title">{{ "Speed curve" | translate }}</h3>
    <div class="app-charts">
      <div class="app-charts-row">
        <h4>{{ "Ping" | translate }}</h4>
        <app-test-chart phase="ping"></app-test-chart>
        <app-ping-details [details]="pingTable()"></app-ping-details>
      </div>
      <div class="app-charts-row">
        <h4>{{ "Download" | translate }}</h4>
        <app-test-chart phase="download"></app-test-chart>
        <app-speed-details [details]="downloadTable()"></app-speed-details>
      </div>
      <div class="app-charts-row">
        <h4>{{ "Upload" | translate }}</h4>
        <app-test-chart phase="upload"></app-test-chart>
        <app-speed-details [details]="uploadTable()"></app-speed-details>
      </div>
      @if (signalTable().length) {
      <div class="app-charts-row">
        <h4>{{ "Signal" | translate }}</h4>
        <app-signal-chart [details]="signalTable()"></app-signal-chart>
        <!-- <app-speed-details [details]="uploadTable()"></app-speed-details> -->
      </div>
      }
    </div>
    }
    <h3 class="app-title">{{ "Detailed results" | translate }}</h3>
    <div class="app-container">
      @if (showFullDetails()) {
      <app-table
        [columns]="columns"
        [data]="detailedResult"
        [shouldHideHeader]="true"
        [tableClassNames]="['app-table--bordered']"
        [sort]="sort"
      ></app-table>
      } @else {
      <app-table
        [columns]="columns"
        [data]="initialDetails()"
        [shouldHideHeader]="true"
        [tableClassNames]="['app-table--bordered']"
        [sort]="sort"
      ></app-table>
      <button
        (click)="showFullDetails.set(true)"
        class="app-button"
        style="margin-top: 24px"
        mat-stroked-button
      >
        {{ "Show additional information..." | translate }}
      </button>
      }
    </div>
  </ng-container>
</div>
}
<app-footer></app-footer>

<ng-template #noResult>
  <main
    *ngIf="error$ | async as error"
    class="app-wrapper app-wrapper--no-result"
  >
    {{ "Measurement failed." | translate }} {{ error.message }}
  </main>
  <main
    *ngIf="(error$ | async) === null"
    class="app-wrapper app-wrapper--no-result"
  >
    {{ "Fetching the result..." | translate }}
  </main>
</ng-template>
